name: Chaos PR ownership

on:
  pull_request:
    types: [opened, reopened, synchronize, ready_for_review]
    paths:
      - 'chaos-board/**'

permissions:
  pull-requests: write

jobs:
  sanitize:
    runs-on: ubuntu-latest
    steps:
      - name: Set Copilot-only assignee/reviewer
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          HUMAN_LOGIN: jono-booth
          COPILOT_LOGIN: copilot-swe-agent
        run: |
          set -euo pipefail

          # Remove human from assignees/reviewers (if present)
          gh pr edit "$PR_URL" --remove-assignee "$HUMAN_LOGIN" || true
          gh pr edit "$PR_URL" --remove-reviewer "$HUMAN_LOGIN" || true

          # Ensure Copilot is the only assignee
          gh pr edit "$PR_URL" --add-assignee "$COPILOT_LOGIN" || true

          # Best-effort: request Copilot as reviewer.
          # This may fail if Copilot is the PR author (GitHub disallows requesting review from the author).
          gh pr edit "$PR_URL" --add-reviewer "$COPILOT_LOGIN" || true
